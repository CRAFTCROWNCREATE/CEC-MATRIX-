<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGENT EVE4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #0d1117; color: #00FF41; font-family: 'Courier New', monospace; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* MATRIX BG */
        #matrix { position: fixed; top:0; left:0; width:100%; height:100%; opacity: 0.2; pointer-events: none; z-index: 0;}
        
        /* CHAT INTERFACE */
        #interface { position: relative; z-index: 10; flex: 1; display: flex; flex-direction: column; padding: 10px; }
        #chat-history { flex: 1; overflow-y: auto; padding: 10px; border: 1px solid #30363d; background: rgba(0,0,0,0.5); border-radius: 8px; margin-bottom: 10px; }
        
        .msg { margin-bottom: 8px; padding: 8px; border-radius: 4px; font-size: 0.9rem; word-wrap: break-word; }
        .msg.sys { border-left: 3px solid #00FF41; background: rgba(0, 255, 65, 0.1); align-self: flex-start; }
        .msg.user { border-right: 3px solid #00F3FF; background: rgba(0, 243, 255, 0.1); color: #00F3FF; text-align: right; align-self: flex-end; }
        
        /* INPUT AREA */
        .input-box { display: flex; gap: 10px; }
        input { flex: 1; background: #010409; border: 1px solid #30363d; color: white; padding: 12px; border-radius: 4px; outline: none; }
        input:focus { border-color: #00FF41; }
        button { background: #238636; color: white; padding: 0 20px; font-weight: bold; border-radius: 4px; }
    </style>
</head>
<body>
    <canvas id="matrix"></canvas>

    <div id="interface">
        <div id="chat-history">
            <div class="msg sys">EVE4: ONLINE. SOVEREIGN MEMORY ACTIVE.<br>TYPE "HELP" FOR COMMANDS.</div>
        </div>
        
        <div class="input-box">
            <input type="text" id="cmd" placeholder="Enter command..." onkeypress="if(event.key==='Enter') send()">
            <button onclick="send()">SEND</button>
        </div>
    </div>

    <script>
        // --- SOVEREIGN MEMORY LOGIC ---
        const MEMORY_KEY = "cec_eve4_brain";
        
        // Load Memory on Start
        window.onload = function() {
            startMatrix();
            const memory = localStorage.getItem(MEMORY_KEY);
            if(memory) {
                const history = JSON.parse(memory);
                const chat = document.getElementById('chat-history');
                // Clear default msg if we have history
                if(history.length > 0) chat.innerHTML = '';
                history.forEach(m => addBubble(m.type, m.text, false));
            }
        };

        function addBubble(type, text, save=true) {
            const chat = document.getElementById('chat-history');
            const div = document.createElement('div');
            div.className = `msg ${type}`;
            div.innerHTML = text; // Use innerHTML to allow line breaks
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;

            if(save) {
                const history = JSON.parse(localStorage.getItem(MEMORY_KEY) || "[]");
                history.push({type, text});
                if(history.length > 100) history.shift(); // Keep last 100 msgs
                localStorage.setItem(MEMORY_KEY, JSON.stringify(history));
            }
        }

        function send() {
            const input = document.getElementById('cmd');
            const text = input.value;
            if(!text) return;

            addBubble('user', text);
            input.value = "";

            // --- AGENT BRAIN ---
            setTimeout(() => {
                const cmd = text.toLowerCase().trim();
                let reply = "EVE4: Processing...";

                // INSTRUCTION PROTOCOLS
                if(cmd === 'help') {
                    reply = "COMMANDS:<br>- 'STATUS': Check System<br>- 'UPLOAD': How to update me<br>- 'CLEAR': Wipe memory<br>- 'DASH': Load Dashboard Data";
                }
                else if(cmd.includes('upload') || cmd.includes('update')) {
                    reply = "<b>HOW TO UPDATE:</b><br>1. Save new code as 'agent.html' or 'dashboard.html'.<br>2. Drag file into GitHub Repo.<br>3. Commit Changes.<br>4. I will auto-update.";
                }
                else if(cmd.includes('status')) {
                    reply = "SYSTEM: OPERATIONAL<br>CONN: LOCAL<br>MEMORY: PERSISTENT<br>SECURITY: SOVEREIGN";
                }
                else if(cmd === 'clear') {
                    localStorage.removeItem(MEMORY_KEY);
                    reply = "MEMORY WIPED. REBOOTING...";
                    setTimeout(() => location.reload(), 1500);
                }
                else {
                    reply = `EVE4: Logged "${text}". I am listening.`;
                }

                addBubble('sys', reply);
            }, 500);
        }

        // --- MATRIX VISUALS ---
        function startMatrix() {
            const c = document.getElementById('matrix'), ctx = c.getContext('2d');
            c.width = window.innerWidth; c.height = window.innerHeight;
            const drops = Array(Math.floor(c.width/20)).fill(1);
            setInterval(() => {
                ctx.fillStyle = 'rgba(0,0,0,0.05)'; ctx.fillRect(0,0,c.width,c.height);
                ctx.fillStyle = '#0F0';
                drops.forEach((y,i) => {
                    ctx.fillText(String.fromCharCode(0x30A0+Math.random()*96), i*20, y*20);
                    if(y*20 > c.height && Math.random()>0.975) drops[i]=0; drops[i]++;
                });
            }, 50);
        }
    </script>
</body>
</html>
