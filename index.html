<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>CEC WAM // SOVEREIGN CORE</title>
		<style>
			:root {
				--neon-blue: #00f3ff;
				--neon-gold: #ffd700;
				--alert-red: #ff3333;
				--bg-dark: #050505;
				--panel-bg: rgba(10, 15, 20, 0.85);
				--font-main: "Courier New", Courier, monospace;
			}

			* {
				box-sizing: border-box;
			}

			body {
				background-color: var(--bg-dark);
				color: var(--neon-blue);
				font-family: var(--font-main);
				margin: 0;
				padding: 0;
				overflow: hidden; /* Full screen app feel */
				height: 100vh;
				display: grid;
				grid-template-rows: 60px 1fr 200px; /* Header, Main, Footer */
			}

			/* --- HUD Header --- */
			header {
				border-bottom: 2px solid var(--neon-blue);
				padding: 0 20px;
				display: flex;
				align-items: center;
				justify-content: space-between;
				background: rgba(0, 0, 0, 0.9);
				box-shadow: 0 0 10px var(--neon-blue);
			}
			header h1 {
				font-size: 1.5em;
				margin: 0;
				text-shadow: 0 0 5px var(--neon-blue);
			}
			.status-light {
				width: 15px;
				height: 15px;
				border-radius: 50%;
				background-color: var(--neon-gold);
				box-shadow: 0 0 10px var(--neon-gold);
				margin-left: 10px;
				animation: pulse-gold 1s infinite alternate;
			}

			@keyframes pulse-gold {
				from { opacity: 0.5; }
				to { opacity: 1; box-shadow: 0 0 15px var(--neon-gold); }
			}
			
			/* --- Main Content Area --- */
			main {
				padding: 20px;
				display: grid;
				gap: 20px;
				/* Responsive Grid: Stacks on mobile, 2 columns on larger screens */
				grid-template-columns: 1fr;
				overflow-y: auto; 
			}
			@media (min-width: 768px) {
				main {
					grid-template-columns: 2fr 1fr; /* Canvas (2 parts) and Core Status (1 part) */
				}
			}

			.panel {
				background: var(--panel-bg);
				border: 1px solid var(--neon-blue);
				border-radius: 5px;
				padding: 15px;
				box-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
			}

			/* --- Core Status Panel Specifics --- */
			#core-status-panel {
				display: flex;
				flex-direction: column;
				justify-content: space-between;
			}
			.metric-group {
				margin-bottom: 15px;
				border-bottom: 1px dashed rgba(0, 243, 255, 0.3);
				padding-bottom: 10px;
			}
			.metric-group h3 {
				color: var(--neon-gold);
				font-size: 1.1em;
				margin-top: 0;
				margin-bottom: 5px;
				text-shadow: none;
			}
			.metric-value {
				font-size: 1.4em;
				font-weight: bold;
				color: var(--neon-blue);
			}
			.status-active { color: #00ff6a; }
			.status-error { color: var(--alert-red); }

			/* --- Canvas / Visualization --- */
			#canvas-container {
				display: flex;
				flex-direction: column;
				min-height: 400px; /* Ensure visibility on mobile */
			}
			#canvas-container h2 {
				color: var(--neon-gold);
				font-size: 1.2em;
				margin-bottom: 10px;
				text-align: center;
			}
			canvas {
				flex-grow: 1;
				background-color: rgba(0, 0, 0, 0.4);
				border: 1px solid var(--neon-blue);
				box-shadow: 0 0 15px rgba(0, 243, 255, 0.8);
			}

			/* --- Footer (Log and Controls) --- */
			#footer {
				display: grid;
				grid-template-columns: 1fr;
				gap: 15px;
				padding: 15px 20px;
				border-top: 2px solid var(--neon-gold);
				background: rgba(0, 0, 0, 0.9);
			}
			@media (min-width: 600px) {
				#footer {
					grid-template-columns: 2fr 1fr; /* Log (2 parts) and Controls (1 part) */
				}
			}

			#log-container {
				max-height: 170px;
				overflow-y: scroll;
				border: 1px solid var(--neon-gold);
				padding: 10px;
				background: rgba(0, 0, 0, 0.6);
				font-size: 0.85em;
				line-height: 1.4;
			}
			.log-entry { margin-bottom: 3px; }
			.log-info { color: var(--neon-blue); }
			.log-warn { color: var(--neon-gold); }

			#controls {
				display: flex;
				flex-direction: column;
				gap: 8px;
			}
			.control-btn {
				background: var(--neon-blue);
				color: var(--bg-dark);
				border: none;
				padding: 8px 12px;
				border-radius: 4px;
				font-family: var(--font-main);
				font-weight: bold;
				cursor: pointer;
				transition: background 0.3s, box-shadow 0.3s;
				text-transform: uppercase;
				box-shadow: 0 0 5px var(--neon-blue);
			}
			.control-btn:hover {
				background: var(--neon-gold);
				color: var(--bg-dark);
				box-shadow: 0 0 15px var(--neon-gold);
			}
		</style>
	</head>
	<body>
		<header>
			<h1>CEC WAM // SOVEREIGN CORE</h1>
			<div style="display: flex; align-items: center;">
				<span style="font-size: 0.9em;">SYSTEM STATUS: ACTIVE</span>
				<div id="status-light" class="status-light"></div>
			</div>
		</header>

		<main>
			<!-- Column 1: Visualization (Canvas) -->
			<div id="canvas-container" class="panel">
				<h2>WAM SENSOR VISUALIZATION (CDL Flow)</h2>
				<canvas id="wamCanvas"></canvas>
			</div>

			<!-- Column 2: CEC-WAM Core Status Panel (New Data) -->
			<div id="core-status-panel" class="panel">
				<div>
					<h2 style="color: var(--neon-gold); text-align: center; margin-top: 0;">CORE CALCULATION METRICS</h2>
					
					<div class="metric-group">
						<h3>CONSCIOUSNESS PRESSURE ($\Psi_c$)</h3>
						<div id="psi-consciousness" class="metric-value">0.000 $s^{-2}$</div>
						<small>Conscious Energy Contribution</small>
					</div>

					<div class="metric-group">
						<h3>DARK ENERGY PRESSURE ($\Psi_{de}$)</h3>
						<div id="psi-dark-energy" class="metric-value">0.000 $s^{-2}$</div>
						<small>Cosmic Expansion Baseline</small>
					</div>
					
					<div class="metric-group">
						<h3>TOTAL EXPANSION PRESSURE ($\Psi_{total}$)</h3>
						<div id="psi-total" class="metric-value" style="color: #00ff6a;">0.000 $s^{-2}$</div>
						<small>The combined pressure driving the system</small>
					</div>
				</div>

				<!-- New Server Integration Status -->
				<div>
					<h3 style="color: var(--neon-gold); text-align: center; margin-bottom: 10px;">EXTERNAL SERVER INTEGRATION</h3>
					<div class="metric-group">
						<h3>SERVER STATUS</h3>
						<div id="ext-server-status" class="metric-value status-active">ACTIVE</div>
					</div>
					<div class="metric-group">
						<h3>WAM INDEX (Final)</h3>
						<div id="final-wam-index" class="metric-value" style="color: var(--neon-gold);">0.000</div>
					</div>
					<div class="metric-group" style="border-bottom: none; padding-bottom: 0;">
						<h3>CDL INTEGRITY</h3>
						<div id="cdl-integrity" class="metric-value">1.000</div>
					</div>
				</div>
			</div>
		</main>

		<footer id="footer">
			<!-- Column 1: Command Log -->
			<div>
				<h3 style="color: var(--neon-blue); margin: 0 0 5px 0;">SYSTEM LOG</h3>
				<div id="log-container">
					<div class="log-entry log-info">[00:00:00] Interface loaded. Initializing systems...</div>
				</div>
			</div>

			<!-- Column 2: Controls -->
			<div id="controls">
				<button class="control-btn" onclick="runDiagnostic()">RUN DIAGNOSTIC</button>
				<button class="control-btn" onclick="syncEve()">SYNC EVE NODE</button>
			</div>
		</footer>

		<script>
			// --- SYSTEM INITIALIZATION ---
			const canvas = document.getElementById("wamCanvas");
			const ctx = canvas.getContext("2d");
			let width, height;
			
			// --- CEC CALCULATION LOGIC (Copied from the Node.js Server) ---
			
			const CONSTANTS = {
				// Physical Constants
				c: 299792458, // Speed of light (m/s)

				// Dark Energy Parameters (From DarkEnergy.csv)
				Lambda: 1.1056e-52, // Cosmological constant (m^-2)

				// Conscious Energy Parameters (Using AI Rig from Conscious.csv as server proxy)
				E_info_W: 600, // Power to maintain organized information (W)
				V_local_m3: 0.05, // Occupied volume of system (m^3)
				alpha_eff: 0.002, // Awareness efficiency (unitless)
			};
			
			/**
			 * Function to calculate the Effective Expansion Pressure (Psi) and Consciousness Pressure (Psi_c).
			 * @returns {object} Calculated values of Psi, Psi_c, and Psi_total.
			 */
			function calculateCECValues() {
				const { c, Lambda, E_info_W, V_local_m3, alpha_eff } = CONSTANTS;

				// 1. Calculate Effective Expansion Pressure (Psi) from Dark Energy
				// Formula: Ψ = (Λ * c^2) / 3
				const Psi_dark_energy = (Lambda * (c ** 2)) / 3;

				// 2. Calculate Consciousness Pressure Term (Psi_c)
				// Formula: Ψ_c = α * E_info / V_local
				const Psi_consciousness = alpha_eff * (E_info_W / V_local_m3);

				// 3. Total Pressure (Psi_total)
				const Psi_total = Psi_dark_energy + Psi_consciousness;

				// Format numbers to scientific notation for display clarity
				const formatSci = (num) => num.toExponential(3);

				return {
					Psi_dark_energy: formatSci(Psi_dark_energy),
					Psi_consciousness: formatSci(Psi_consciousness),
					Psi_total: formatSci(Psi_total),
					// Simulating the new server's payload for the client
					integrated_server_data: simulateNewServerIntegration(),
				};
			}

			/**
			 * Simulates the data retrieval from the new server, including some randomization.
			 * In a real environment, this would be a network fetch call.
			 */
			function simulateNewServerIntegration() {
				// Simulate random fluctuations in integrity and load
				const cdlIntegrity = 0.999 + (Math.random() * 0.002 - 0.001); // 0.998 to 1.000
				const status = Math.random() > 0.05 ? "ACTIVE" : "WARNING"; // 5% chance of warning
				
				return {
					status: status,
					cdl_integrity: cdlIntegrity,
					// The final WAM Index uses the integrity factor
					final_wam_factor: cdlIntegrity, 
				}
			}

			// --- UI UPDATER AND SIMULATION LOOP ---

			function updateDashboard() {
				const cec_values = calculateCECValues();
				const server_data = cec_values.integrated_server_data;
				
				// 1. Update CEC Metric Panel
				document.getElementById('psi-consciousness').innerText = `${cec_values.Psi_consciousness} s⁻²`;
				document.getElementById('psi-dark-energy').innerText = `${cec_values.Psi_dark_energy} s⁻²`;
				document.getElementById('psi-total').innerText = `${cec_values.Psi_total} s⁻²`;

				// 2. Update New Server Integration Status
				const statusElement = document.getElementById('ext-server-status');
				statusElement.innerText = server_data.status;
				statusElement.className = server_data.status === 'ACTIVE' ? 'metric-value status-active' : 'metric-value status-error';

				// 3. Update CDL Integrity
				const cdlIntegrity = server_data.cdl_integrity.toFixed(4);
				document.getElementById('cdl-integrity').innerText = cdlIntegrity;

				// 4. Update Final WAM Index (Psi_total value multiplied by CDL Integrity Factor)
				const rawPsiTotal = parseFloat(cec_values.Psi_total); // Back to number for calculation
				const finalWamIndex = (rawPsiTotal * server_data.final_wam_factor).toExponential(3);
				document.getElementById('final-wam-index').innerText = finalWamIndex;

				// Random Status Logs
				if (Math.random() > 0.8) {
					const msgs = [
						"Checking neural pathways...",
						"Eve signal strength: 98%",
						"Encrypting local packet...",
						"Background scan complete.",
						`WAM Sensor 4: ${server_data.status}`,
						`Integrity Check: ${cdlIntegrity} OK`,
					];
					addLog(msgs[Math.floor(Math.random() * msgs.length)]);
				}
			}


			// --- WAM VISUALIZATION (CANVAS) ---
			let particles = [];
			const PARTICLE_COUNT = 150;
			
			function setupCanvas() {
				width = canvas.clientWidth;
				height = canvas.clientHeight;
				canvas.width = width;
				canvas.height = height;

				particles = [];
				for (let i = 0; i < PARTICLE_COUNT; i++) {
					particles.push({
						x: Math.random() * width,
						y: Math.random() * height,
						radius: Math.random() * 2 + 1,
						color: Math.random() > 0.5 ? varToRgba("--neon-blue", 0.8) : varToRgba("--neon-gold", 0.8),
						vx: Math.random() * 1 - 0.5,
						vy: Math.random() * 1 - 0.5,
						pulse: Math.random() * 0.05
					});
				}
			}

			function varToRgba(varName, alpha) {
				const hex = getComputedStyle(document.documentElement).getPropertyValue(varName);
				if (!hex || hex.length < 7) return `rgba(0, 0, 0, ${alpha})`;
				const r = parseInt(hex.slice(1, 3), 16);
				const g = parseInt(hex.slice(3, 5), 16);
				const b = parseInt(hex.slice(5, 7), 16);
				return `rgba(${r}, ${g}, ${b}, ${alpha})`;
			}

			function draw() {
				ctx.clearRect(0, 0, width, height);

				for (let i = 0; i < particles.length; i++) {
					const p = particles[i];
					
					// Update position
					p.x += p.vx;
					p.y += p.vy;

					// Boundary collision
					if (p.x < 0 || p.x > width) p.vx *= -1;
					if (p.y < 0 || p.y > height) p.vy *= -1;

					// Draw particle
					ctx.beginPath();
					const currentRadius = p.radius + Math.sin(Date.now() * p.pulse) * 0.5;
					ctx.arc(p.x, p.y, currentRadius, 0, Math.PI * 2);
					ctx.fillStyle = p.color;
					ctx.shadowColor = p.color.replace(/, [\d\.]+\)/, ', 1)');
					ctx.shadowBlur = 5;
					ctx.fill();

					// Draw connecting lines (representing WAM / CDL flow)
					for (let j = i + 1; j < particles.length; j++) {
						const p2 = particles[j];
						const dist = Math.sqrt((p.x - p2.x) ** 2 + (p.y - p2.y) ** 2);
						if (dist < 80) {
							ctx.beginPath();
							ctx.moveTo(p.x, p.y);
							ctx.lineTo(p2.x, p2.y);
							ctx.strokeStyle = `rgba(0, 243, 255, ${1 - dist / 80})`;
							ctx.lineWidth = 1;
							ctx.stroke();
						}
					}
				}
			}

			function animate() {
				draw();
				requestAnimationFrame(animate);
			}

			// --- LOGGING AND CONTROL FUNCTIONS ---
			
			function addLog(message, type = "info") {
				const logContainer = document.getElementById("log-container");
				const timestamp = new Date().toTimeString().slice(0, 8);
				const newEntry = document.createElement("div");
				newEntry.className = `log-entry log-${type}`;
				newEntry.innerText = `[${timestamp}] ${message}`;
				
				// Prepend the new log entry
				logContainer.prepend(newEntry);
				// Limit log entries to keep performance high
				while (logContainer.children.length > 50) {
					logContainer.removeChild(logContainer.lastChild);
				}
			}
			
			function runDiagnostic() {
				addLog("RUNNING FULL SYSTEM DIAGNOSTIC...", "warn");
				setTimeout(
					() =>
						addLog(
							"DIAGNOSTIC COMPLETE. ALL SYSTEMS GREEN.",
							"info"
						),
					1500
				);
			}

			function syncEve() {
				addLog("ATTEMPTING HANDSHAKE WITH EVE...", "warn");
				setTimeout(
					() => addLog("HANDSHAKE SUCCESSFUL. SYNCED.", "info"),
					2000
				);
			}
			
			// --- WINDOW LOAD & EVENT LISTENERS ---

			window.onload = function() {
				setupCanvas();
				animate();
				
				// Start the main data update loop using the integrated server logic
				setInterval(updateDashboard, 2000);
				
				// Initial update
				updateDashboard();
			}

			window.onresize = setupCanvas;
		</script>
	</body>
</html>

